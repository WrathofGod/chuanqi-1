/**
 * Created by Administrator on 2016/2/16.
 */
/**
 * Created by Sara on 2015/11/12.
 */

var mailDao = require("uw-mail").mailDao;
var MailEntity = require("uw-entity").MailEntity;
var c_prop=  require("uw-data").c_prop;
var async = require("async");
var exports = module.exports;var scriptUtils = require("./scriptUtils");

var guildWarData = {"10069":{"_guildWarDic":{"1":{"serverName":"QQ浏览器专区-69服","serverId":10069,"serverHost":"121.43.165.50","serverPort":"4199","guildId":1,"guildName":"散人也奔放","guildLvl":26,"doorLives":4,"points":40000,"progress":100,"groupId":1,"doorData":{"0":{"door":0,"hp":10000,"userId":2306,"userName":"s69.三哥","userIcon":1,"isBreak":0,"lastDownTime":null},"1":{"door":1,"hp":10000,"userId":4441,"userName":"s69.夏文石","userIcon":1,"lastUserId":3917,"lastUserName":"s69.夏侯奇伟","lastUserIcon":1,"isBreak":0,"lastDownTime":"2016-07-01T12:39:52.518Z"},"2":{"door":2,"hp":10000,"userId":2517,"userName":"s69.韦祺","userIcon":1,"lastUserId":2714,"lastUserName":"s69.百灵狂人","lastUserIcon":1,"isBreak":0,"lastDownTime":"2016-07-01T12:14:38.271Z"},"3":{"door":3,"hp":10000,"userId":2354,"userName":"s69.暴击小战","userIcon":1,"isBreak":0,"lastDownTime":null}},"rank":1,"chairmanData":[2517,"s69.韦祺",6,1],"lastLootTime":0,"fightRecordArr":[],"refreshId":18,"maxPoints":40000},"8":{"serverName":"QQ浏览器专区-69服","serverId":10069,"serverHost":"121.43.165.50","serverPort":"4199","guildId":8,"guildName":"审判团","guildLvl":15,"doorLives":0,"points":0,"progress":100,"groupId":3,"doorData":{"0":{"door":0,"hp":0,"userId":null,"userName":null,"userIcon":null,"isBreak":1,"lastDownTime":null},"1":{"door":1,"hp":0,"userId":null,"userName":null,"userIcon":null,"isBreak":1,"lastDownTime":null},"2":{"door":2,"hp":0,"userId":null,"userName":null,"userIcon":null,"isBreak":1,"lastDownTime":null},"3":{"door":3,"hp":0,"userId":null,"userName":null,"userIcon":null,"isBreak":1,"lastDownTime":null}},"rank":0,"chairmanData":[5088,"s69.冷血",2,4],"lastLootTime":0,"fightRecordArr":[{"id":115,"type":2,"attackData":null,"beAttackData":[0,"QQ浏览器专区-93服","轩辕天下","s93.慕容和畅"],"time":null},{"id":116,"type":2,"attackData":null,"beAttackData":[0,"QQ浏览器专区-91服","指点江山","s91.殷康顺"],"time":null},{"id":117,"type":2,"attackData":null,"beAttackData":[0,"QQ浏览器专区-93服","轩辕天下","s93.错过"],"time":null},{"id":118,"type":2,"attackData":null,"beAttackData":[0,"QQ浏览器专区-99服","大家一起飞","s99.别城"],"time":null},{"id":119,"type":2,"attackData":null,"beAttackData":[0,"QQ浏览器专区-91服","指点江山","s91.情断♪♪♪"],"time":null},{"id":120,"type":2,"attackData":null,"beAttackData":[0,"QQ浏览器专区-96服","轩辕剑","s96.柳秀媚"],"time":null},{"id":121,"type":2,"attackData":null,"beAttackData":[0,"QQ浏览器专区-91服","指点江山","s91.公冶沛白"],"time":null},{"id":122,"type":2,"attackData":null,"beAttackData":[0,"QQ浏览器专区-78服","神ぃ觉醒❦","s78.神汐、"],"time":null},{"id":123,"type":2,"attackData":null,"beAttackData":[0,"QQ浏览器专区-88服","快乐88！！！","s88.惜源水"],"time":null}],"refreshId":0,"maxPoints":40000}},"_guildWarUserDic":{"2306":{"userId":2306,"userName":"s69.三哥","guildId":1,"guildName":"散人也奔放","points":0,"vip":13,"iconId":1,"lastLootTime":0,"rank":6,"groupId":1,"nextFightTime":"2016-07-01T12:00:25.582Z","inspireEndTime":"2016-07-01T12:00:25.582Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":19668155},"2354":{"userId":2354,"userName":"s69.暴击小战","guildId":1,"guildName":"散人也奔放","points":0,"vip":9,"iconId":1,"lastLootTime":0,"rank":5,"groupId":1,"nextFightTime":"2016-07-01T12:00:25.094Z","inspireEndTime":"2016-07-01T12:00:25.094Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":10558664},"2362":{"userId":2362,"userName":"s69.寂寞","guildId":1,"guildName":"散人也奔放","points":0,"vip":11,"iconId":5,"lastLootTime":0,"rank":19,"groupId":1,"nextFightTime":"2016-07-01T12:02:41.830Z","inspireEndTime":"2016-07-01T12:02:41.830Z","guildPosition":3,"nextUpTime":"2016-07-01T12:10:40.468Z","serverId":"10069","combat":12447783},"2418":{"userId":2418,"userName":"s69.雪貂","guildId":1,"guildName":"散人也奔放","points":0,"vip":1,"iconId":5,"lastLootTime":0,"rank":3,"groupId":1,"nextFightTime":"2016-07-01T12:00:22.044Z","inspireEndTime":"2016-07-01T12:00:22.044Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":3289525},"2517":{"userId":2517,"userName":"s69.韦祺","guildId":1,"guildName":"散人也奔放","points":0,"vip":6,"iconId":1,"lastLootTime":0,"rank":9,"groupId":1,"nextFightTime":"2016-07-01T12:00:45.715Z","inspireEndTime":"2016-07-01T12:00:45.715Z","guildPosition":1,"nextUpTime":null,"serverId":"10069","combat":8742179},"2706":{"userId":2706,"userName":"s69.班兴贤","guildId":1,"guildName":"散人也奔放","points":0,"vip":1,"iconId":1,"lastLootTime":0,"rank":21,"groupId":1,"nextFightTime":"2016-07-01T12:03:45.397Z","inspireEndTime":"2016-07-01T12:03:45.397Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":2038900},"2714":{"userId":2714,"userName":"s69.百灵狂人","guildId":1,"guildName":"散人也奔放","points":0,"vip":0,"iconId":1,"lastLootTime":0,"rank":24,"groupId":1,"nextFightTime":"2016-07-01T12:09:53.449Z","inspireEndTime":"2016-07-01T12:09:53.449Z","guildPosition":3,"nextUpTime":"2016-07-01T12:12:30.438Z","serverId":"10069","combat":2271868},"2730":{"userId":2730,"userName":"s69.故事未结束","guildId":1,"guildName":"散人也奔放","points":0,"vip":1,"iconId":5,"lastLootTime":0,"rank":15,"groupId":1,"nextFightTime":"2016-07-01T12:01:27.824Z","inspireEndTime":"2016-07-01T12:01:27.824Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":2596514},"2734":{"userId":2734,"userName":"s69.快乐14","guildId":1,"guildName":"散人也奔放","points":0,"vip":0,"iconId":2,"lastLootTime":0,"rank":27,"groupId":1,"nextFightTime":"2016-07-01T12:17:20.678Z","inspireEndTime":"2016-07-01T12:17:20.678Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":995081},"2749":{"userId":2749,"userName":"s69.海涛✔","guildId":1,"guildName":"散人也奔放","points":0,"vip":8,"iconId":1,"lastLootTime":0,"rank":18,"groupId":1,"nextFightTime":"2016-07-01T12:00:10.495Z","inspireEndTime":"2016-07-01T12:00:10.495Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":9875558},"2812":{"userId":2812,"userName":"s69.め只属于祢","guildId":1,"guildName":"散人也奔放","points":0,"vip":4,"iconId":5,"lastLootTime":0,"rank":13,"groupId":1,"nextFightTime":"2016-07-01T12:01:03.454Z","inspireEndTime":"2016-07-01T12:01:03.454Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":5598841},"2823":{"userId":2823,"userName":"s69.计兰馨","guildId":1,"guildName":"散人也奔放","points":0,"vip":1,"iconId":6,"lastLootTime":0,"rank":10,"groupId":1,"nextFightTime":"2016-07-01T12:00:52.527Z","inspireEndTime":"2016-07-01T12:00:52.527Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":1606372},"3329":{"userId":3329,"userName":"s69.过后就发钱","guildId":1,"guildName":"散人也奔放","points":0,"vip":10,"iconId":4,"lastLootTime":0,"rank":4,"groupId":1,"nextFightTime":"2016-07-01T12:00:22.929Z","inspireEndTime":"2016-07-01T12:00:22.929Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":9329037},"3702":{"userId":3702,"userName":"s69.孤单的北半球","guildId":1,"guildName":"散人也奔放","points":0,"vip":0,"iconId":4,"lastLootTime":0,"rank":32,"groupId":1,"nextFightTime":"2016-07-01T12:29:18.278Z","inspireEndTime":"2016-07-01T12:31:59.270Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":1099597},"3799":{"userId":3799,"userName":"s69.烟花易冷☞嶉","guildId":1,"guildName":"散人也奔放","points":0,"vip":4,"iconId":1,"lastLootTime":0,"rank":14,"groupId":1,"nextFightTime":"2016-07-01T12:01:09.478Z","inspireEndTime":"2016-07-01T12:01:09.478Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":3531717},"3829":{"userId":3829,"userName":"s69.皇甫采珊","guildId":1,"guildName":"散人也奔放","points":0,"vip":1,"iconId":6,"lastLootTime":0,"rank":8,"groupId":1,"nextFightTime":"2016-07-01T12:00:29.795Z","inspireEndTime":"2016-07-01T12:00:29.795Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":3368388},"3917":{"userId":3917,"userName":"s69.夏侯奇伟","guildId":1,"guildName":"散人也奔放","points":0,"vip":5,"iconId":1,"lastLootTime":0,"rank":22,"groupId":1,"nextFightTime":"2016-07-01T12:06:01.822Z","inspireEndTime":"2016-07-01T12:06:01.822Z","guildPosition":3,"nextUpTime":"2016-07-01T12:39:57.518Z","serverId":"10069","combat":7439643},"4078":{"userId":4078,"userName":"s69.殷月桃","guildId":1,"guildName":"散人也奔放","points":0,"vip":6,"iconId":2,"lastLootTime":0,"rank":30,"groupId":1,"nextFightTime":"2016-07-01T12:26:28.016Z","inspireEndTime":"2016-07-01T12:29:40.756Z","guildPosition":3,"nextUpTime":"2016-07-01T12:39:19.064Z","serverId":"10069","combat":3246189},"4191":{"userId":4191,"userName":"s69.夏侯修竹","guildId":1,"guildName":"散人也奔放","points":0,"vip":4,"iconId":1,"lastLootTime":0,"rank":35,"groupId":1,"nextFightTime":"2016-07-01T12:48:24.865Z","inspireEndTime":"2016-07-01T12:48:24.865Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":3624636},"4248":{"userId":4248,"userName":"s69.倪业","guildId":1,"guildName":"散人也奔放","points":0,"vip":1,"iconId":1,"lastLootTime":0,"rank":2,"groupId":1,"nextFightTime":"2016-07-01T12:00:09.761Z","inspireEndTime":"2016-07-01T12:00:09.761Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":2098998},"4441":{"userId":4441,"userName":"s69.夏文石","guildId":1,"guildName":"散人也奔放","points":0,"vip":9,"iconId":1,"lastLootTime":0,"rank":11,"groupId":1,"nextFightTime":"2016-07-01T12:00:53.465Z","inspireEndTime":"2016-07-01T12:00:53.465Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":9689379},"4454":{"userId":4454,"userName":"s69.风少","guildId":1,"guildName":"散人也奔放","points":0,"vip":1,"iconId":1,"lastLootTime":0,"rank":34,"groupId":1,"nextFightTime":"2016-07-01T12:40:55.089Z","inspireEndTime":"2016-07-01T12:40:55.089Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":1325673},"4668":{"userId":4668,"userName":"s69.松鼠","guildId":1,"guildName":"散人也奔放","points":0,"vip":12,"iconId":6,"lastLootTime":0,"rank":26,"groupId":1,"nextFightTime":"2016-07-01T12:14:34.691Z","inspireEndTime":"2016-07-01T12:14:34.691Z","guildPosition":3,"nextUpTime":"2016-07-01T12:36:13.539Z","serverId":"10069","combat":15469441},"4932":{"userId":4932,"userName":"s69.曾曼","guildId":1,"guildName":"散人也奔放","points":0,"vip":2,"iconId":2,"lastLootTime":0,"rank":20,"groupId":1,"nextFightTime":"2016-07-01T12:03:31.573Z","inspireEndTime":"2016-07-01T12:03:31.573Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":3191140},"4970":{"userId":4970,"userName":"s69.郭曼婉","guildId":1,"guildName":"散人也奔放","points":0,"vip":1,"iconId":4,"lastLootTime":0,"rank":16,"groupId":1,"nextFightTime":"2016-07-01T12:01:42.315Z","inspireEndTime":"2016-07-01T12:01:42.315Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":2347447},"5067":{"userId":5067,"userName":"s69.修罗","guildId":1,"guildName":"散人也奔放","points":0,"vip":1,"iconId":1,"lastLootTime":0,"rank":33,"groupId":1,"nextFightTime":"2016-07-01T12:35:45.074Z","inspireEndTime":"2016-07-01T12:35:45.074Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":981875},"5255":{"userId":5255,"userName":"s69.ツ〆妍︶ㄣ","guildId":1,"guildName":"散人也奔放","points":0,"vip":4,"iconId":2,"lastLootTime":0,"rank":1,"groupId":1,"nextFightTime":"2016-07-01T12:02:38.438Z","inspireEndTime":"2016-07-01T12:02:38.438Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":2184192},"5485":{"userId":5485,"userName":"s69.夜v巅峰","guildId":1,"guildName":"散人也奔放","points":0,"vip":4,"iconId":1,"lastLootTime":0,"rank":17,"groupId":1,"nextFightTime":"2016-07-01T12:01:54.844Z","inspireEndTime":"2016-07-01T12:01:54.844Z","guildPosition":2,"nextUpTime":null,"serverId":"10069","combat":3366267},"5682":{"userId":5682,"userName":"s69.小松鼠","guildId":1,"guildName":"散人也奔放","points":0,"vip":1,"iconId":1,"lastLootTime":0,"rank":31,"groupId":1,"nextFightTime":"2016-07-01T12:29:12.768Z","inspireEndTime":"2016-07-01T12:29:12.768Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":2513057},"5700":{"userId":5700,"userName":"s69.♀彡仯妕汜忆","guildId":1,"guildName":"散人也奔放","points":0,"vip":1,"iconId":2,"lastLootTime":0,"rank":12,"groupId":1,"nextFightTime":"2016-07-01T12:00:56.784Z","inspireEndTime":"2016-07-01T12:00:56.784Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":1276107},"5711":{"userId":5711,"userName":"s69.螃蟹哥哥","guildId":1,"guildName":"散人也奔放","points":0,"vip":0,"iconId":2,"lastLootTime":0,"rank":28,"groupId":1,"nextFightTime":"2016-07-01T12:20:17.625Z","inspireEndTime":"2016-07-01T12:20:17.625Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":613518},"5763":{"userId":5763,"userName":"s69.。蕊","guildId":1,"guildName":"散人也奔放","points":0,"vip":3,"iconId":1,"lastLootTime":0,"rank":7,"groupId":1,"nextFightTime":"2016-07-01T12:00:27.314Z","inspireEndTime":"2016-07-01T12:00:27.314Z","guildPosition":3,"nextUpTime":"2016-07-01T12:38:52.247Z","serverId":"10069","combat":2212246},"5770":{"userId":5770,"userName":"s69.无聊风","guildId":1,"guildName":"散人也奔放","points":0,"vip":1,"iconId":3,"lastLootTime":0,"rank":29,"groupId":1,"nextFightTime":"2016-07-01T12:24:07.729Z","inspireEndTime":"2016-07-01T12:24:07.729Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":736410},"5784":{"userId":5784,"userName":"s69.醉红尘","guildId":1,"guildName":"散人也奔放","points":0,"vip":0,"iconId":1,"lastLootTime":0,"rank":23,"groupId":1,"nextFightTime":"2016-07-01T12:09:30.767Z","inspireEndTime":"2016-07-01T12:09:30.767Z","guildPosition":3,"nextUpTime":null,"serverId":"10069","combat":311246},"5823":{"userId":5823,"userName":"s69.-：不离","guildId":1,"guildName":"散人也奔放","points":0,"vip":0,"iconId":3,"lastLootTime":0,"rank":25,"groupId":1,"nextFightTime":"2016-07-01T12:12:18.201Z","inspireEndTime":"2016-07-01T12:12:18.201Z","guildPosition":3,"nextUpTime":"2016-07-01T12:12:39.004Z","serverId":"10069","combat":20785}},"_fightRecordId":123}};

//用户排序
var _sortUserRankList = function (list) {
    //this._guildWarGroupDic
    //数据结构：[行会id,行会积分]
    var sortKeyArr = ["points", "combat"]; //排序规则：积分＞最后掠夺
    var sortType = [-1, -1]; //积分降序，最后掠夺升序
    list.sort(function (a, b) {
        for (var i = 0; i < 2; i++) {
            var type = sortType[i];
            if (a[sortKeyArr[i]] > b[sortKeyArr[i]]) {
                return type <= 0 ? -1 : 1;
            }
            else if (a[sortKeyArr[i]] < b[sortKeyArr[i]]) {
                return type <= 0 ? 1 : -1;
            }
        }
        return 0;
    });
    return list;
};


var check = function(guildId,serverId){
    var data = guildWarData[serverId];
    var userArr = [];
    for(var key in data._guildWarUserDic){
        var locUserData = data._guildWarUserDic[key];
        if(locUserData.guildId==guildId){
            userArr.push(locUserData);
        }
    }
    _sortUserRankList(userArr);
    for(var i = 0;i<10;i++){
        var locUser = userArr[i];
        if(!locUser) continue;
        console.log("userId:%s,userName:%s,combat:%s",locUser.userId,locUser.userName,locUser.combat);
    }
};


check(1,10069)